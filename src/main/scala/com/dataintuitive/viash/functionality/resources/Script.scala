package com.dataintuitive.viash.functionality.resources

import com.dataintuitive.viash.functionality.Functionality

trait Script extends Resource {
  def command(script: String): String

  def commandSeq(script: String): Seq[String]

  def generatePlaceholder(functionality: Functionality): String

  val commentStr: String

  def readWithPlaceholder(implicit functionality: Functionality): Option[String] = {
    read.map(code => {
      val lines = code.split("\n")
      val startIndex = lines.indexWhere(_.contains("VIASH START"))
      val endIndex = lines.indexWhere(_.contains("VIASH END"))

      val li =
        Array(
          commentStr + " The following code has been auto-generated by Viash.",
          generatePlaceholder(functionality)
        ) ++ {
          if (startIndex >= 0 && endIndex >= 0) {
            lines.slice(0, startIndex + 1) ++ lines.slice(endIndex, lines.length)
          } else {
            lines
          }
        }

      li.mkString("\n")
    })
  }
}
